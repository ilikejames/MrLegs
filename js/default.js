var soundmanager=function(){var b={};return{preloadSounds:function(c){for(var l=0,q;q=c[l];l++){var f=document.getElementById(q);f&&f.play&&(f.volume=0,f.play(),b[q]=f,setTimeout(_.partial(function(b){b.pause();b.volume=0.2},f),10))}},playSound:function(c){(c=b[c])&&c.play&&(c.paused||(c.currentTime=0),c.play())}}}();var birdAnimations=function(){function b(){for(var a=[],b=0;2>b;b++)for(var k=0;4>k;k++)a.push({x:200*k,y:210*b,width:200,height:210});return{flight:a}}function c(){g++;var d=Math.floor(12*Math.random())+4+r/m,k;k=5<a?Math.floor(Math.random()*(n.getHeight()-150)):Math.floor(Math.random()*((n.getHeight()-150)/(d/5)));var e=1.8/d*a,c=400*e,f=n.getWidth()/c,d=7,d=new Kinetic.Sprite({x:n.getWidth(),y:k,image:p,scale:e,animation:"flight",animations:b(),frameRate:d,index:d});h.add(d);d.start();d.on("mousedown",
function(a){console.log("click object",a,this)});(new Kinetic.Tween({node:d,duration:f,x:-c,onFinish:function(){this.node.destroy();this.destroy();g--;l()}})).play();l()}function l(){g<s+15&&setTimeout(c,Math.random()*m)}function q(a){e=new Kinetic.Image({image:a,name:"crosshair",x:0,y:0,offset:{x:55,y:56},opacity:0.5});k.add(e);k.draw()}function f(a){e&&(e.setAttrs({x:a.pageX,y:a.pageY,visible:"A"!=a.target.tagName}),k.draw())}var h,p,n,r=8400,m=r,s=0,a=1,g=0,k,e;return{start:function(a,b){n=a;h=
b;p=new Image;p.onload=c;p.src="images/birdsprite.png";k=new Kinetic.Layer({x:0,y:0,width:a.getWidth(),height:a.getHeight(),fill:"red"});n.add(k);var g=new Image;g.onload=_.bind(q,this,g);g.src="images/crosshair.png";soundmanager.preloadSounds(["soundBirdDeath"]);$(window).on("mousemove",_.throttle(f,25))},onClick:function(b){if((b=h.getIntersection(b))&&b.shape){b=b.shape;g--;var k=n.getHeight()-b.getY()+b.getHeight(),k=Math.sqrt(k/200);s++;0==s%2&&(m*=0.66);0==s%10&&(a*=20<s?20:s,m*=3,setTimeout(function(){a=
1;m=r},6E3));soundmanager.playSound("soundBirdDeath");(new Kinetic.Tween({node:b,duration:k,easing:Kinetic.Easings.EaseIn,y:n.getHeight()+b.getHeight(),onFinish:function(){this.node.destroy();this.destroy()}})).play();setTimeout(c,100)}}}}();var bombui=function(){function b(a,b,g,c,h){for(var f=[];a<b;a++)f.push({x:a*c,y:g,width:c,height:h});return f}function c(){var a=new Kinetic.Image({x:0,y:0,image:this,width:h.getWidth(),height:h.getHeight()});p.add(a);a=new Image;a.onload=l;a.src="images/bomb/sprite5.png"}function l(){r=new Kinetic.Sprite({x:0,y:405,image:this,animation:"normal",animations:s,frameRate:0});p.add(r);r.start();m=new Kinetic.Sprite({x:128,y:268,image:this,animation:"normal",animations:g,frameRate:0});p.add(m);m.start();
for(var b=0;4>b;b++){var e;e=b;var d=new Kinetic.Sprite({x:265+210*e,y:390,image:this,animation:3==b?"burning":"unlit",animations:a,frameRate:10});d.on("mouseover",_.partial(q,"mouseover"));d.on("mouseout",_.partial(q,"mouseout"));d.on("click touchstart",_.partial(f,e));e=d;n.push(e);p.add(e);e.start()}}function q(a,b){"burning"==this.getAnimation()&&(document.body.style.cursor="mouseover"==a?"pointer":"default")}function f(a,b){if("burning"==this.getAnimation()){document.body.style.cursor="default";
var g=this;g.setOffset(98,-50);g.stop();setTimeout(function(){m.setAnimation(a);0<a?n[a-1].setAnimation("burning"):(r.setAnimation("burnt"),soundmanager.playSound("soundScream"),r.start())},20);g.afterFrame(4,function(){g.stop();g.destroy()});g.setAnimation("explode");g.start();soundmanager.playSound("soundExplosion")}}var h,p,n=[],r,m,s={normal:[{x:35,y:1010,width:230,height:350}],burnt:[{x:305,y:1010,width:230,height:350}]},a={unlit:[{x:0,y:680,width:161,height:320}],burning:b(1,3,686,161,320),
explode:b(0,3,0,357,341).concat(b(0,3,342,357,341))},g={normal:[{x:0,y:1408,width:1070,height:87}],3:[{x:0,y:1496,width:1070,height:87}],2:[{x:0,y:1585,width:1070,height:82}],1:[{x:0,y:1670,width:1070,height:82}],0:[{x:0,y:1762,width:1070,height:87}]};return{init:function(a){h=new Kinetic.Stage({container:a,width:1280,height:780});soundmanager.preloadSounds(["soundExplosion","soundScream"]);p=new Kinetic.Layer({});h.add(p);a=new Image;a.onload=c;a.src="images/bomb/bombbackground.png"},setWidth:function(a){h.setScale(a/
1280)}}}();(function(b){"function"===typeof define&&define.amd?define(["jquery"],b):b(jQuery)})(function(b){var c=[],l=b(document),q=navigator.userAgent.toLowerCase(),f=b(window),h=[],p=null,n=/msie/.test(q)&&!/opera/.test(q),r=/opera/.test(q),m,s;m=n&&/msie 6./.test(q)&&"object"!==typeof window.XMLHttpRequest;s=n&&/msie 7.0/.test(q);b.modal=function(a,g){return b.modal.impl.init(a,g)};b.modal.close=function(){b.modal.impl.close()};b.modal.focus=function(a){b.modal.impl.focus(a)};b.modal.setContainerDimensions=
function(){b.modal.impl.setContainerDimensions()};b.modal.setPosition=function(){b.modal.impl.setPosition()};b.modal.update=function(a,g){b.modal.impl.update(a,g)};b.fn.modal=function(a){return b.modal.impl.init(this,a)};b.modal.defaults={appendTo:"body",focus:!0,opacity:50,overlayId:"simplemodal-overlay",overlayCss:{},containerId:"simplemodal-container",containerCss:{},dataId:"simplemodal-data",dataCss:{},minHeight:null,minWidth:null,maxHeight:null,maxWidth:null,autoResize:!1,autoPosition:!0,zIndex:1E3,
close:!0,closeHTML:'<a class="modalCloseImg" title="Close"></a>',closeClass:"simplemodal-close",escClose:!0,overlayClose:!1,fixed:!0,position:null,persist:!1,modal:!0,onOpen:null,onShow:null,onClose:null};b.modal.impl={d:{},init:function(a,g){if(this.d.data)return!1;p=n&&!b.support.boxModel;this.o=b.extend({},b.modal.defaults,g);this.zIndex=this.o.zIndex;this.occb=!1;if("object"===typeof a){if(a=a instanceof b?a:b(a),this.d.placeholder=!1,0<a.parent().parent().size()&&(a.before(b("<span></span>").attr("id",
"simplemodal-placeholder").css({display:"none"})),this.d.placeholder=!0,this.display=a.css("display"),!this.o.persist))this.d.orig=a.clone(!0)}else if("string"===typeof a||"number"===typeof a)a=b("<div></div>").html(a);else return alert("SimpleModal Error: Unsupported data type: "+typeof a),this;this.create(a);this.open();b.isFunction(this.o.onShow)&&this.o.onShow.apply(this,[this.d]);return this},create:function(a){this.getDimensions();this.o.modal&&m&&(this.d.iframe=b('<iframe src="javascript:false;"></iframe>').css(b.extend(this.o.iframeCss,
{display:"none",opacity:0,position:"fixed",height:h[0],width:h[1],zIndex:this.o.zIndex,top:0,left:0})).appendTo(this.o.appendTo));this.d.overlay=b("<div></div>").attr("id",this.o.overlayId).addClass("simplemodal-overlay").css(b.extend(this.o.overlayCss,{display:"none",opacity:this.o.opacity/100,height:this.o.modal?c[0]:0,width:this.o.modal?c[1]:0,position:"fixed",left:0,top:0,zIndex:this.o.zIndex+1})).appendTo(this.o.appendTo);this.d.container=b("<div></div>").attr("id",this.o.containerId).addClass("simplemodal-container").css(b.extend({position:this.o.fixed?
"fixed":"absolute"},this.o.containerCss,{display:"none",zIndex:this.o.zIndex+2})).append(this.o.close&&this.o.closeHTML?b(this.o.closeHTML).addClass(this.o.closeClass):"").appendTo(this.o.appendTo);this.d.wrap=b("<div></div>").attr("tabIndex",-1).addClass("simplemodal-wrap").css({height:"100%",outline:0,width:"100%"}).appendTo(this.d.container);this.d.data=a.attr("id",a.attr("id")||this.o.dataId).addClass("simplemodal-data").css(b.extend(this.o.dataCss,{display:"none"})).appendTo("body");this.setContainerDimensions();
this.d.data.appendTo(this.d.wrap);(m||p)&&this.fixIE()},bindEvents:function(){var a=this;b("."+a.o.closeClass).bind("click.simplemodal",function(b){b.preventDefault();a.close()});a.o.modal&&a.o.close&&a.o.overlayClose&&a.d.overlay.bind("click.simplemodal",function(b){b.preventDefault();a.close()});l.bind("keydown.simplemodal",function(b){a.o.modal&&9===b.keyCode?a.watchTab(b):a.o.close&&a.o.escClose&&27===b.keyCode&&(b.preventDefault(),a.close())});f.bind("resize.simplemodal orientationchange.simplemodal",
function(){a.getDimensions();a.o.autoResize?a.setContainerDimensions():a.o.autoPosition&&a.setPosition();m||p?a.fixIE():a.o.modal&&(a.d.iframe&&a.d.iframe.css({height:h[0],width:h[1]}),a.d.overlay.css({height:c[0],width:c[1]}))})},unbindEvents:function(){b("."+this.o.closeClass).unbind("click.simplemodal");l.unbind("keydown.simplemodal");f.unbind(".simplemodal");this.d.overlay.unbind("click.simplemodal")},fixIE:function(){var a=this.o.position;b.each([this.d.iframe||null,this.o.modal?this.d.overlay:
null,"fixed"===this.d.container.css("position")?this.d.container:null],function(b,k){if(k){var e=k[0].style;e.position="absolute";if(2>b)e.removeExpression("height"),e.removeExpression("width"),e.setExpression("height",'document.body.scrollHeight > document.body.clientHeight ? document.body.scrollHeight : document.body.clientHeight + "px"'),e.setExpression("width",'document.body.scrollWidth > document.body.clientWidth ? document.body.scrollWidth : document.body.clientWidth + "px"');else{var d,c;a&&
a.constructor===Array?(d=a[0]?"number"===typeof a[0]?a[0].toString():a[0].replace(/px/,""):k.css("top").replace(/px/,""),d=-1===d.indexOf("%")?d+' + (t = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "px"':parseInt(d.replace(/%/,""))+' * ((document.documentElement.clientHeight || document.body.clientHeight) / 100) + (t = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "px"',a[1]&&(c="number"===
typeof a[1]?a[1].toString():a[1].replace(/px/,""),c=-1===c.indexOf("%")?c+' + (t = document.documentElement.scrollLeft ? document.documentElement.scrollLeft : document.body.scrollLeft) + "px"':parseInt(c.replace(/%/,""))+' * ((document.documentElement.clientWidth || document.body.clientWidth) / 100) + (t = document.documentElement.scrollLeft ? document.documentElement.scrollLeft : document.body.scrollLeft) + "px"')):(d='(document.documentElement.clientHeight || document.body.clientHeight) / 2 - (this.offsetHeight / 2) + (t = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "px"',
c='(document.documentElement.clientWidth || document.body.clientWidth) / 2 - (this.offsetWidth / 2) + (t = document.documentElement.scrollLeft ? document.documentElement.scrollLeft : document.body.scrollLeft) + "px"');e.removeExpression("top");e.removeExpression("left");e.setExpression("top",d);e.setExpression("left",c)}}})},focus:function(a){var g=this;a=a&&-1!==b.inArray(a,["first","last"])?a:"first";var c=b(":input:enabled:visible:"+a,g.d.wrap);setTimeout(function(){0<c.length?c.focus():g.d.wrap.focus()},
10)},getDimensions:function(){var a="undefined"===typeof window.innerHeight?f.height():window.innerHeight;c=[l.height(),l.width()];h=[a,f.width()]},getVal:function(a,b){return a?"number"===typeof a?a:"auto"===a?0:0<a.indexOf("%")?parseInt(a.replace(/%/,""))/100*("h"===b?h[0]:h[1]):parseInt(a.replace(/px/,"")):null},update:function(a,b){if(!this.d.data)return!1;this.d.origHeight=this.getVal(a,"h");this.d.origWidth=this.getVal(b,"w");this.d.data.hide();a&&this.d.container.css("height",a);b&&this.d.container.css("width",
b);this.setContainerDimensions();this.d.data.show();this.o.focus&&this.focus();this.unbindEvents();this.bindEvents()},setContainerDimensions:function(){var a=m||s,b=this.d.origHeight?this.d.origHeight:r?this.d.container.height():this.getVal(a?this.d.container[0].currentStyle.height:this.d.container.css("height"),"h"),a=this.d.origWidth?this.d.origWidth:r?this.d.container.width():this.getVal(a?this.d.container[0].currentStyle.width:this.d.container.css("width"),"w"),c=this.d.data.outerHeight(!0),e=
this.d.data.outerWidth(!0);this.d.origHeight=this.d.origHeight||b;this.d.origWidth=this.d.origWidth||a;var d=this.o.maxHeight?this.getVal(this.o.maxHeight,"h"):null,f=this.o.maxWidth?this.getVal(this.o.maxWidth,"w"):null,d=d&&d<h[0]?d:h[0],f=f&&f<h[1]?f:h[1],l=this.o.minHeight?this.getVal(this.o.minHeight,"h"):"auto",b=b?this.o.autoResize&&b>d?d:b<l?l:b:c?c>d?d:this.o.minHeight&&"auto"!==l&&c<l?l:c:l,d=this.o.minWidth?this.getVal(this.o.minWidth,"w"):"auto",a=a?this.o.autoResize&&a>f?f:a<d?d:a:e?
e>f?f:this.o.minWidth&&"auto"!==d&&e<d?d:e:d;this.d.container.css({height:b,width:a});this.d.wrap.css({overflow:c>b||e>a?"auto":"visible"});this.o.autoPosition&&this.setPosition()},setPosition:function(){var a,b;a=h[0]/2-this.d.container.outerHeight(!0)/2;b=h[1]/2-this.d.container.outerWidth(!0)/2;var c="fixed"!==this.d.container.css("position")?f.scrollTop():0;this.o.position&&"[object Array]"===Object.prototype.toString.call(this.o.position)?(a=c+(this.o.position[0]||a),b=this.o.position[1]||b):
a=c+a;this.d.container.css({left:b,top:a})},watchTab:function(a){if(0<b(a.target).parents(".simplemodal-container").length){if(this.inputs=b(":input:enabled:visible:first, :input:enabled:visible:last",this.d.data[0]),!a.shiftKey&&a.target===this.inputs[this.inputs.length-1]||a.shiftKey&&a.target===this.inputs[0]||0===this.inputs.length)a.preventDefault(),this.focus(a.shiftKey?"last":"first")}else a.preventDefault(),this.focus()},open:function(){this.d.iframe&&this.d.iframe.show();b.isFunction(this.o.onOpen)?
this.o.onOpen.apply(this,[this.d]):(this.d.overlay.show(),this.d.container.show(),this.d.data.show());this.o.focus&&this.focus();this.bindEvents()},close:function(){if(!this.d.data)return!1;this.unbindEvents();if(b.isFunction(this.o.onClose)&&!this.occb)this.occb=!0,this.o.onClose.apply(this,[this.d]);else{if(this.d.placeholder){var a=b("#simplemodal-placeholder");this.o.persist?a.replaceWith(this.d.data.removeClass("simplemodal-data").css("display",this.display)):(this.d.data.hide().remove(),a.replaceWith(this.d.orig))}else this.d.data.hide().remove();
this.d.container.hide().remove();this.d.overlay.hide();this.d.iframe&&this.d.iframe.hide().remove();this.d.overlay.remove();this.d={}}}}});$(function(){var b=new Kinetic.Stage({container:"birds",width:window.innerWidth,height:window.innerHeight}),c=new Kinetic.Layer({width:b.getWidth(),height:b.getHeight()});b.add(c);birdAnimations.start(b,c);bombui.init("carousel");bombui.setWidth($("#carousel").width());$("#app-store .iphone").click(function(b){$("#iphone-not-ready").modal({overlayClose:!0,autoResize:!0,autoPosition:!0});return!1});$(window).resize(_.debounce(function(c){bombui.setWidth($("#carousel").width());b.setWidth($(document).width());
b.setHeight($(document).height())},100));$(window).on("mousedown touchstart",function(b){birdAnimations.onClick({x:b.clientX,y:b.clientY})})});
